(window.webpackJsonp=window.webpackJsonp||[]).push([[47],{214:function(t,s,a){"use strict";a.r(s);var n=a(0),r=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("div",{staticClass:"content"},[t._m(0),t._v(" "),t._m(1),t._v(" "),t._m(2),t._v(" "),t._m(3),t._v(" "),t._m(4),t._v(" "),s("p",[t._v("就是插件运行的进程，每个插件一个进程，单独隔离出是为了防止插件挂了影响用户。")]),t._v(" "),t._m(5),t._v(" "),s("p",[t._v("负责UI界面渲染")]),t._v(" "),t._m(6),t._v(" "),s("p",[t._v("负责网络资源加载")]),t._v(" "),t._m(7),t._v(" "),s("p",[t._v("负责除了Tab标签页外的所有进程，包括界面展示，用户交互，子进程管理，文件存取等。")]),t._v(" "),t._m(8),t._v(" "),s("p",[t._v("主要负责将 HTML, CSS, JavaScript 转换为用户可交互的网页，排版引擎 Blink 和 JavaScript 引擎 V8 就运行在渲染进程，默认每个 tab 一个渲染进程（特殊情况下面的进程模式会讲）。")]),t._v(" "),t._m(9),t._v(" "),t._m(10),t._v(" "),s("p",[t._v("Chromium 提供了四种进程模式，不同的进程模式会对 tab 进程做不同的处理，比如采用某个模式况会给 tab 分配新进程，而采用另外一个模式则不会，下面是四种模式的介绍，Chrome 默认采用第一个模式")]),t._v(" "),t._m(11),t._v(" "),s("p",[s("strong",[t._v("Process-per-site-instance")]),t._v(" 是最重要的，因为这个是 Chrome 默认使用的模式，也就是几乎所有的用户都在用的模式。当你打开一个 tab 访问 "),s("a",{attrs:{href:"https://link.zhihu.com/?target=https%3A//a.baidu.com",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://a.baidu.com"),s("OutboundLink")],1),t._v("，然后再打开一个 tab 访问 "),s("a",{attrs:{href:"https://link.zhihu.com/?target=https%3A//b.baidu.com",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://b.baidu.com"),s("OutboundLink")],1),t._v("，这两个 tab 会使用"),s("strong",[t._v("两个进程")]),t._v("。如果 "),s("a",{attrs:{href:"https://link.zhihu.com/?target=https%3A//b.baidu.com",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://b.baidu.com"),s("OutboundLink")],1),t._v(" 是通过 "),s("a",{attrs:{href:"https://link.zhihu.com/?target=https%3A//a.baidu.com",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://a.baidu.com"),s("OutboundLink")],1),t._v(" 页面的 JavaScript 代码打开的，这两个 tab 会使用"),s("strong",[t._v("同一个进程")]),t._v("，比如下图的例子，可以看到两个 tab 的 processId 是相同的。")]),t._v(" "),t._m(12),t._v(" "),t._m(13),t._v(" "),t._m(14),t._v(" "),s("p",[t._v("所以开了一个Tab，最少有四个进程。")]),t._v(" "),t._m(15),t._v(" "),t._m(16),t._v(" "),t._m(17),t._v(" "),t._m(18),t._v(" "),s("p",[t._v("这是一个特殊的异步任务，注册的方法不会加入到Task队列。而是加载到渲染的队列中，在渲染的三个步骤之前执行，处理渲染相关的工作。")]),t._v(" "),t._m(19),t._m(20),s("p",[t._v("上面的代码执行之后就会发现setTImeout要比animation快的多。")]),t._v(" "),t._m(21),t._v(" "),t._m(22),t._v(" "),t._m(23),t._v(" "),t._m(24),t._v(" "),t._m(25),t._v(" "),s("p",[s("a",{attrs:{href:"http://link.zhihu.com/?target=https%3A//html.spec.whatwg.org/multipage/webappapis.html%23event-loops",target:"_blank",rel:"noopener noreferrer"}},[t._v("WHATWG"),s("OutboundLink")],1),t._v(" 规范中定义了事件循环，")]),t._v(" "),s("p",[t._v("1、从task队列中取最老的一个task，执行它（如果没有任务队列，直接跳到微任务步骤）；")]),t._v(" "),s("p",[t._v("2、"),s("strong",[t._v("Microtasks")]),t._v("：执行microtasks任务**"),s("a",{attrs:{href:"http://link.zhihu.com/?target=https%3A//html.spec.whatwg.org/multipage/webappapis.html%23perform-a-microtask-checkpoint",target:"_blank",rel:"noopener noreferrer"}},[t._v("检查点"),s("OutboundLink")],1),t._v("**；")]),t._v(" "),t._m(26),t._v(" "),s("p",[t._v("4、判断是否启动**"),s("a",{attrs:{href:"http://link.zhihu.com/?target=https%3A//w3c.github.io/requestidlecallback/%23start-an-idle-period-algorithm",target:"_blank",rel:"noopener noreferrer"}},[t._v("空闲时间算法"),s("OutboundLink")],1),t._v("**")]),t._v(" "),s("p",[t._v("5、event loop 重复执行")]),t._v(" "),t._m(27),t._v(" "),t._m(28),t._v(" "),t._m(29),t._v(" "),s("ul",[t._m(30),t._v(" "),s("li",[s("p",[t._v("页面卡死 主线程任务队列 比如微任务一直执行，导致task 任务队列没有机会执行 卡死 其他IO设备没有反应 页面无法渲染")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/39292837",target:"_blank",rel:"noopener noreferrer"}},[t._v("卡顿监控"),s("OutboundLink")],1)])]),t._v(" "),s("li",[s("p",[t._v("页面直接崩溃 可能是插件问题，被攻击 防火墙等问题")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://link.zhihu.com/?target=http%3A//jasonjl.me/blog/2015/06/21/taking-action-on-browser-crashes/",target:"_blank",rel:"noopener noreferrer"}},[t._v("崩溃监控"),s("OutboundLink")],1)])])]),t._v(" "),t._m(31),t._v(" "),t._m(32),t._v(" "),t._m(33),t._v(" "),t._m(34),t._m(35),t._v(" "),t._m(36),t._v(" "),t._m(37),t._v(" "),t._m(38)])}),[function(){var t=this._self._c;return t("h1",{attrs:{id:"工作原理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#工作原理"}},[this._v("#")]),this._v(" 工作原理")])},function(){var t=this._self._c;return t("h2",{attrs:{id:"多进程架构"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#多进程架构"}},[this._v("#")]),this._v(" 多进程架构")])},function(){var t=this._self._c;return t("p",[t("strong",[this._v("我们平时接触的js主要有两个运行环境，一个是Node，一个是浏览器。平时说的JavaScript是单线程，其实说的是运行在Render 进程的 主线程上。而运行环境是多线程的，你看到的是单线程而已， 现代浏览器主要都是多进程架构")])])},function(){var t=this._self._c;return t("h3",{attrs:{id:"进程分类"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#进程分类"}},[this._v("#")]),this._v(" 进程分类")])},function(){var t=this._self._c;return t("h3",{attrs:{id:"插件进程（plugin-process"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#插件进程（plugin-process"}},[this._v("#")]),this._v(" 插件进程（Plugin process)")])},function(){var t=this._self._c;return t("h3",{attrs:{id:"gpu-进程（gpu-process）"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#gpu-进程（gpu-process）"}},[this._v("#")]),this._v(" GPU 进程（GPU process）")])},function(){var t=this._self._c;return t("h3",{attrs:{id:"网络进程（network-process）"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#网络进程（network-process）"}},[this._v("#")]),this._v(" 网络进程（Network process）")])},function(){var t=this._self._c;return t("h3",{attrs:{id:"浏览器主进程（browser-process）"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#浏览器主进程（browser-process）"}},[this._v("#")]),this._v(" 浏览器主进程（Browser process）")])},function(){var t=this._self._c;return t("h3",{attrs:{id:"渲染进程-renderer-process）"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#渲染进程-renderer-process）"}},[this._v("#")]),this._v(" 渲染进程 (Renderer process）")])},function(){var t=this._self._c;return t("p",[t("img",{attrs:{src:"https://pic2.zhimg.com/v2-12dcfec1e4e079c89be0c5fd086c53e5_b.jpg",alt:"border"}})])},function(){var t=this._self._c;return t("h3",{attrs:{id:"进程的四种模式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#进程的四种模式"}},[this._v("#")]),this._v(" 进程的四种模式")])},function(){var t=this,s=t._self._c;return s("ul",[s("li",[s("strong",[t._v("Process-per-site-instance")]),t._v(" (default) - 同一个 "),s("strong",[t._v("site-instance")]),t._v(" 使用一个进程")]),t._v(" "),s("li",[s("strong",[t._v("Process-per-site -")]),t._v(" 同一个 "),s("strong",[t._v("site")]),t._v(" 使用一个进程")]),t._v(" "),s("li",[s("strong",[t._v("Process-per-tab -")]),t._v(" 每个 tab 使用一个进程")]),t._v(" "),s("li",[s("strong",[t._v("Single process -")]),t._v(" 所有 tab 共用一个进程")])])},function(){var t=this._self._c;return t("p",[this._v("同一个进程的多个线程是共享内存的。所以当两个 tab 使用同一个进程的时候，这两个 tab 就是“通的”。比如 A 页面使用 JavaScript 打开 B 页面，那么 B 页面可以通过 "),t("code",[this._v("window.opener")]),this._v(" 访问 A 页面的 "),t("code",[this._v("window")]),this._v(" 对象。")])},function(){var t=this._self._c;return t("h3",{attrs:{id:"面向服务的架构"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#面向服务的架构"}},[this._v("#")]),this._v(" 面向服务的架构")])},function(){var t=this._self._c;return t("p",[t("img",{attrs:{src:"https://pic1.zhimg.com/v2-0ad8ab7b2df126d9ba4c08e627bdcbda_b.webp",alt:"border"}})])},function(){var t=this,s=t._self._c;return s("ul",[s("li",[t._v("浏览器进程")]),t._v(" "),s("li",[t._v("GPU进程")]),t._v(" "),s("li",[t._v("插件进程")]),t._v(" "),s("li",[t._v("渲染进程\n"),s("ul",[s("li",[t._v("主线程：运行JavaScript、DOM、CSS、样式布局计算")]),t._v(" "),s("li",[t._v("工作线程 运行 Web Worker、Service Worker")]),t._v(" "),s("li",[t._v("合成线程 将图层分层 并发送绘制命令给浏览器进程")])])])])},function(){var t=this._self._c;return t("h3",{attrs:{id:"渲染的过程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#渲染的过程"}},[this._v("#")]),this._v(" 渲染的过程")])},function(){var t=this._self._c;return t("p",[t("img",{attrs:{src:"",alt:"border"}})])},function(){var t=this._self._c;return t("h3",{attrs:{id:"requestanimationframe"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#requestanimationframe"}},[this._v("#")]),this._v(" requestAnimationFrame")])},function(){var t=this,s=t._self._c;return s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[t._v("box"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("style"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("transform "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'translateX(1000px)'")]),t._v("\nbox"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("style"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tranition "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'transform 1s ease'")]),t._v("\n")])])])},function(){var t=this,s=t._self._c;return s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" b1 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("querySelector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'.ball1'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" b2 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("querySelector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'.ball2'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" j "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("moveBoxTenPixel")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("box")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    box"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("style"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("transform "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("translateX(")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("px)")]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    i"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("moveBoxTenPixel2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("box")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    box"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("style"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("transform "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("translateX(")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("j "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("px)")]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    j"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("moveBall")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("moveBoxTenPixel")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("b1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("moveBall"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// moveBall();")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("moveBall2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("moveBoxTenPixel2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("b2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("requestAnimationFrame")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("moveBall2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// moveBall2();")]),t._v("\n")])])])},function(){var t=this._self._c;return t("p",[this._v("那如果我们使用setTimeout 处理动画和此API有什么不同呢。"),t("strong",[this._v("setTimeout 每次运行结束时都把自己添加到task 队列。（不是每次执行队列都会进入到渲染循环中），所以渲染部分下一部分会更新很多像素 而不是1px。requestAnimationFrame 只在渲染过程之前运行，严格遵守执行一次渲染一次。")])])},function(){var t=this._self._c;return t("h3",{attrs:{id:"microtasks"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#microtasks"}},[this._v("#")]),this._v(" Microtasks")])},function(){var t=this._self._c;return t("p",[this._v("微任务队列，Microtasks 就是在 "),t("strong",[this._v("当次")]),this._v(" 事件循环的 "),t("strong",[this._v("结尾 立刻执行")]),this._v(" 的任务。"),t("code",[this._v("Promise.then()")]),this._v(" 内部的代码就属于 microtasks。相对而言，之前的异步队列 (Task queue) 就叫做 macrotasks，不过一般还是简称为 tasks。加上requestAnimationFrame队列目前共有三个")])},function(){var t=this,s=t._self._c;return s("ul",[s("li",[t._v("Tasks (in "),s("code",[t._v("setTimeout")]),t._v(")")]),t._v(" "),s("li",[t._v("Animation callbacks (in "),s("code",[t._v("requestAnimationFrame")]),t._v(")")]),t._v(" "),s("li",[t._v("Microtasks (in "),s("code",[t._v("Promise.then")]),t._v(")")])])},function(){var t=this._self._c;return t("h3",{attrs:{id:"事件循环-event-loop"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#事件循环-event-loop"}},[this._v("#")]),this._v(" 事件循环 Event Loop")])},function(){var t=this._self._c;return t("p",[this._v("3、"),t("strong",[this._v("Update the rendering")]),this._v("更新渲染")])},function(){var t=this._self._c;return t("p",[t("img",{attrs:{src:"https://pic3.zhimg.com/80/v2-625308b43e94d35a9a1367cc5ebafe2e_1440w.jpg",alt:"border"}})])},function(){var t=this,s=t._self._c;return s("p",[t._v("常见的Task任务有："),s("code",[t._v("事件回调")]),t._v("、"),s("code",[t._v("XHR回调")]),t._v("、"),s("code",[t._v("定时器")]),t._v("。其中setTimeout是多少毫秒"),s("strong",[t._v("推入task队列")]),t._v("。")])},function(){var t=this._self._c;return t("h3",{attrs:{id:"页面死的几种情况"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#页面死的几种情况"}},[this._v("#")]),this._v(" 页面死的几种情况")])},function(){var t=this._self._c;return t("li",[t("p",[this._v("Maximum call stack size exceeded 调用栈溢出。典型的 JS stack 溢出了。一般出现递归 没有返回")])])},function(){var t=this._self._c;return t("p",[this._v("页面卡顿是暂时响应比较慢，JS 可能无法"),t("strong",[this._v("及时执行")]),this._v("，崩溃就是完全看不了 页面不显示。")])},function(){var t=this._self._c;return t("div",{staticClass:"tip custom-block"},[t("p",{staticClass:"custom-block-title"},[this._v("TIP")]),this._v(" "),t("p",[this._v("1、"),t("strong",[this._v("setTimeout 不卡死是因为它被推到任务队列，会循环调用，不会阻塞页面渲染，页面会固定时间段去渲染，（前提是js不会阻塞它）。")])]),this._v(" "),t("p",[this._v("2、"),t("strong",[this._v("微任务如果一直循环执行，会导致任务队列无法执行或相应其他的任务，比如I/O、渲染等。所以会卡死")])])])},function(){var t=this._self._c;return t("h3",{attrs:{id:"意外代码"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#意外代码"}},[this._v("#")]),this._v(" 意外代码")])},function(){var t=this,s=t._self._c;return s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("button"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'click'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  Promise"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'microtask 1'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'listener 1'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nbutton"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'click'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  Promise"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'microtask 2'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'listener 2'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])},function(){var t=this._self._c;return t("p",[this._v("用户直接点击的时候，浏览器先后触发 2 个 listener。第一个 listener 触发完成 ("),t("code",[this._v("listener 1")]),this._v(") 之后，队列空了，就先打印了 microtask 1。然后再执行下一个 listener。"),t("strong",[this._v("重点在于浏览器并不实现知道有几个 listener，因此它发现一个执行一个，执行完了再看后面还有没有。")])])},function(){var t=this._self._c;return t("p",[this._v("而使用 "),t("code",[this._v("button.click()")]),this._v(" 时，浏览器的内部实现是把 2 个 listener 都同步执行。因此 "),t("code",[this._v("listener 1")]),this._v(' 之后，执行队列还没空，还要继续执行 "listener 2" 之后才行。所以 listener 2 会早于 microtask 1。'),t("strong",[this._v("重点在于浏览器的内部实现，"),t("code",[this._v("click")]),this._v(" 方法会先采集有哪些 listener，再依次触发。")])])},function(){var t=this._self._c;return t("h2",{attrs:{id:"消息队列和事件循环"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#消息队列和事件循环"}},[this._v("#")]),this._v(" 消息队列和事件循环")])},function(){var t=this._self._c;return t("h2",{attrs:{id:"v8怎么实现异步编程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#v8怎么实现异步编程"}},[this._v("#")]),this._v(" V8怎么实现异步编程")])}],!1,null,null,null);s.default=r.exports}}]);