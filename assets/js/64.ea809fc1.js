(window.webpackJsonp=window.webpackJsonp||[]).push([[64],{231:function(t,a,s){"use strict";s.r(a);var n=s(0),r=Object(n.a)({},(function(){var t=this,a=t._self._c;return a("div",{staticClass:"content"},[t._m(0),t._v(" "),t._m(1),t._v(" "),a("p",[t._v("解码 PNG 图片就是把一张图片从二进制数据装换成包含像素数据的 ImageData。")]),t._v(" "),a("p",[a("a",{attrs:{href:"http://www.libpng.org/pub/png/spec/1.2/PNG-Contents.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("PNG规范"),a("OutboundLink")],1)]),t._v(" "),t._m(2),t._v(" "),t._m(3),t._v(" "),t._m(4),t._v(" "),t._m(5),t._v(" "),t._m(6),t._v(" "),t._m(7),t._v(" "),t._m(8),t._v(" "),a("ul",[t._m(9),t._v(" "),t._m(10),t._v(" "),a("li",[a("p",[t._v("Buffer")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("ArrayBuffer")]),a("OutboundLink")],1),t._v(" 是在浏览器中唯一一种访问二进制数据的方法。"),a("code",[t._v("ArrayBuffer")]),t._v(" 代表图像的原始二进制数据缓冲区。我们无法读取和写入 "),a("code",[t._v("ArrayBuffer")]),t._v(" ，只能将 "),a("code",[t._v("ArrayBuffer")]),t._v(" 转换为 "),a("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/DataView",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("DataView")]),a("OutboundLink")],1),t._v(" 或 "),a("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/TypedArray",target:"_blank",rel:"noopener noreferrer"}},[t._v("TypedArray"),a("OutboundLink")],1),t._v(" 来读取和写入二进制数据。")]),t._v(" "),a("li",[a("a",{attrs:{href:"https://nodejs.org/api/buffer.html",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("Buffer")]),a("OutboundLink")],1),t._v(" 是 Node.js 中特殊的一种 "),a("code",[t._v("Uint8Array")]),t._v("，Node.js 对其进行了一些优化。")])])])]),t._v(" "),t._m(11),t._v(" "),t._m(12),t._m(13),t._v(" "),t._m(14),t._v(" "),t._m(15),a("p",[t._v("U表示 unsigned, 无符号（都是正值）。8表示8位。里面的数据值不能超过 255。Int8Array是 可以带符号的，所以可以为负数。")]),t._v(" "),t._m(16),t._v(" "),t._m(17),t._v(" "),t._m(18),t._v(" "),t._m(19)])}),[function(){var t=this._self._c;return t("h1",{attrs:{id:"深入应用场景"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#深入应用场景"}},[this._v("#")]),this._v(" 深入应用场景")])},function(){var t=this._self._c;return t("h2",{attrs:{id:"解码-png-图片"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#解码-png-图片"}},[this._v("#")]),this._v(" 解码 PNG 图片")])},function(){var t=this._self._c;return t("h3",{attrs:{id:"图像转换"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#图像转换"}},[this._v("#")]),this._v(" 图像转换")])},function(){var t=this._self._c;return t("blockquote",[t("p",[t("strong",[this._v("图像可以用多种不同的类型数据表示，DOM、URI、File、ImageData、Buffer")])])])},function(){var t=this._self._c;return t("h4",{attrs:{id:"dom"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#dom"}},[this._v("#")]),this._v(" DOM")])},function(){var t=this._self._c;return t("ul",[t("li",[this._v("img 元素从 URL 来加载图像")]),this._v(" "),t("li",[this._v("canvas 通过 drawImage 来获取 "),t("img"),this._v(" 元素上的图像数据")])])},function(){var t=this._self._c;return t("h4",{attrs:{id:"url"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#url"}},[this._v("#")]),this._v(" URL")])},function(){var t=this._self._c;return t("ul",[t("li",[this._v("Data URL 带有base64编码的图像数据。可以从Data URL 数据中解码出图像的二进制数据。Data URL 数据的大小比原始数据的二进制数据大一些。")]),this._v(" "),t("li",[this._v("HTTP URL 代表存储在服务器上的图像，HTTP URL 用于服务器端获取图像数据")]),this._v(" "),t("li",[this._v("Object URL 代表存储在浏览器内存中的 File 或 Blob对象，Object URL 可以由 createObjectURL API 来创建，并由 revokeObject URL API释放")])])},function(){var t=this._self._c;return t("h4",{attrs:{id:"文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#文件"}},[this._v("#")]),this._v(" 文件")])},function(){var t=this._self._c;return t("li",[t("p",[this._v("Blob 带有二进制数据的类文件对象，包含一个只读的size属性和 一个只读的 type属性，可以通过 slice、stream、text 等方法来读取二进制数据")])])},function(){var t=this._self._c;return t("li",[t("p",[this._v("File 对象是一个特殊的 Blob对象，除了Blob的熟悉和方法，File对象还包含 lastModified name 等属性")])])},function(){var t=this._self._c;return t("p",[t("img",{attrs:{src:"https://vivaxyblog.github.io/assets/2019-11-06-comprehensive-image-processing-on-browsers/ArrayBuffer-TypedArray-Buffer-DataView.svg",alt:"border"}})])},function(){var t=this,a=t._self._c;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" upload "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getElementById")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'upload'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nupload"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'change'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("e")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" file "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("files"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" reader "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("FileReader")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    reader"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("readAsArrayBuffer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    reader"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onload")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("e")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" file "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("target"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" blob "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("slice")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" fileBuffer "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Uint8Array")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("blob"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// PNG 图片文件的签名")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Uint8Array(8) [137, 80, 78, 71, 13, 10, 26, 10]")]),t._v("\n      console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fileBuffer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this._self._c;return t("h3",{attrs:{id:"typedarray"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#typedarray"}},[this._v("#")]),this._v(" TypedArray")])},function(){var t=this._self._c;return t("p",[this._v("TypedArray对象描述了一个"),t("strong",[this._v("二进制数据缓冲区的一个类数组视图")]),this._v(" 实际上是没有这个构造函数的，它是下面的类型之一")])},function(){var t=this,a=t._self._c;return a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("Int8Array"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \nUint8Array"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \nUint8ClampedArray"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nInt16Array"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \nUint16Array"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nInt32Array"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \nUint32Array"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \nFloat32Array"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \nFloat64Array"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this._self._c;return t("h3",{attrs:{id:"签名文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#签名文件"}},[this._v("#")]),this._v(" 签名文件")])},function(){var t=this._self._c;return t("p",[this._v("一张 PNG 图片二进制数据的开头必须是这 8 字节："),t("code",[this._v("0x89, 0x50, 0x4e, 0x47, 0x0d, 0x0a, 0x1a, 0x0a")]),this._v("。")])},function(){var t=this._self._c;return t("p",[t("code",[this._v("0x")]),this._v(" 代表这个数字是 16 进制表示的，"),t("code",[this._v("0x89, 0x50, 0x4e, 0x47, 0x0d, 0x0a, 0x1a, 0x0a")]),this._v(" 转换为 10 进制是 "),t("code",[this._v("137, 80, 78, 71, 13, 10, 26, 10")]),this._v("。")])},function(){var t=this,a=t._self._c;return a("table",[a("thead",[a("tr",[a("th",[t._v("0 ~ 3")]),t._v(" "),a("th",[t._v("4 ~ 7")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("code",[t._v("137, 80, 78, 71")])]),t._v(" "),a("td",[a("code",[t._v("13, 10, 26, 10")])])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("0x89, 0x50, 0x4e, 0x47")])]),t._v(" "),a("td",[a("code",[t._v("0x0d, 0x0a, 0x1a, 0x0a")])])])])])}],!1,null,null,null);a.default=r.exports}}]);